<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page - Upload Excel</title>
</head>
<body>
    <h1>Upload Excel File</h1>
    <input type="file" id="fileInput" accept=".xlsx, .xls">
    <button id="uploadBtn">Upload</button>
    
    <script>
        document.getElementById('uploadBtn').addEventListener('click', function () {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file to upload.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const events = {};

                // Assuming your Excel has the first sheet for events
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);

                // Check if the JSON data has the expected structure
                if (!Array.isArray(jsonData) || jsonData.length === 0) {
                    alert('The uploaded file is empty or has an invalid format.');
                    return;
                }

                // Process the data
                jsonData.forEach(row => {
                    const date = row.Date; // Change as per your column names
                    const eventName = row.Event; // Change as per your column names
                    const timeIn = row.TimeIn; // Change as per your column names
                    const timeOut = row.TimeOut; // Change as per your column names

                    if (!date || !eventName || !timeIn || !timeOut) {
                        alert('The uploaded file is missing required fields.');
                        return;
                    }

                    if (!events[date]) {
                        events[date] = [];
                    }

                    events[date].push({
                        name: eventName,
                        TimeIn: timeIn,
                        TimeOut: timeOut
                    });
                });

                // Store events in localStorage
                localStorage.setItem('calendarEvents', JSON.stringify(events));

                // Redirect to the calendar page
                window.location.href = 'index.html'; // Ensure this points to your calendar page
            };

            reader.readAsArrayBuffer(file);
        });
    </script>
    
    <!-- Include the XLSX library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>
</body>
</html>
